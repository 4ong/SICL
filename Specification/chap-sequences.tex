\chapter{Sequence functions}

This module provides high-performance implementations of the
functions in the ``sequences'' chapter of the \hs{}.  High
performance will be obtained by identifying important special cases
such as the use of \texttt{:test} function \texttt{eq}, or
\texttt{equal}, or the use of a \texttt{:key} of \texttt{identity}. 

\section{Current state}

In an attempt to make the functions as fast as possible, we created
lots of different specialized versions for common cases of keyword
arguments.  Preliminary tests show that we improve on the speed
compared to existing commonly used implementations of \commonlisp{}.
However, the existence of all those special cases also makes the
module hard to read and difficult to test.

For that reason, we plan to rewrite this module, using an alternative
strategy.

\section{Future work}
\label{sec-sequence-functions-future-work}

Work is in progress using the techniques in our paper at ELS 2017
\cite{Durand:2017:ELS:Sequence}.  These techniques work well for most
of the sequence functions such as \texttt{find}, \texttt{position},
etc.

Concerning the \emph{sorting functions} (i.e., \texttt{sort} and
\texttt{stable-sort}) there is an interesting challenge with respect
to finding a stable sorting algorithm for vectors that uses little
extra space.  The naive version of mergesort uses $O(n)$ extra space,
but some research (\cite{Huang:1990:FSM:898863},
\cite{Huang:1988:PIM:42392.42403},
\cite{Katajainen:1996:PIM:642136.642138}) indicates that it is
possible to obtain an in-place stable version of mergesort.  Since
mergesort is typically significantly faster than quicksort, this would
be a worthwhile direction to pursue.
