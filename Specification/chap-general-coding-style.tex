\chapter{General \commonlisp{} style guide}

\section{Width of a line of code}

Horizontal space is a precious resource that should not be wasted.
The width of a line should preferably not exceed 80 characters.  This
limit used to be hard, because some printers or printer drivers would
truncate longer lines.  Since it is less common to print code these
days, the limit is now soft.  The purpose of keeping lines somewhat
short is so that it is possible on a reasonable monitor to display two
documents side by side.  One document is typically a \commonlisp{}
source file, and the other document is typically the buffer containing
interactions with the \commonlisp{} system.

The systematic use of long lines makes the practice of displaying two
documents side by side impossible, or at least impractical.  If a
single monitor is used, the programmer then has to flip back and forth
between the source code and the interaction loop.  When two monitors
are used, the effect is to waste half a monitor that could otherwise
be used for displaying documentation or something else.

\section{Blank lines}

A single blank line is common in the following situations:

\begin{itemize}
\item Between two top-level forms.
\item Between a file-specific comment and the following top-level
  form.
\item Between a comment for several top-level forms and the first
  of those top-level forms.
\end{itemize}

A single blank line \emph{may} occur inside a top-level form to
indicate the separation of two blocks of code concerned with different
subjects, but it would be more common to put those two blocks of code
in separate functions.

There should never be any instance of two consecutive blank lines, and
the last line of the file should not be blank.

\section{Different meanings of \texttt{nil}}

Consider the following local variable bindings:

\begin{verbatim}
(let ((x '())
      (y nil)
      z)
  ...)
\end{verbatim}

To the compiler, the three are equivalent.  To a person reading the
code, they mean different things, however:

\begin{itemize}
\item The initialization of \texttt{x} means that \texttt{x} holds a
  \emph{list} that is initially empty.
\item The initialization of \texttt{y} means that \texttt{y} holds a
  Boolean value or a default value that may or may not change in the
  body of the \texttt{let} form.
\item The absence of initialization of \texttt{y} means that no
  initial value is given to \texttt{z}.  In the body of the
  \texttt{let} form, the variable \texttt{z} will be assigned to
  before it is used.
\end{itemize}

The following body of the \texttt{let} form corresponds to the
expectations of the person reading the code:

\begin{verbatim}
(let ((x '())
      (y nil)
      z)
  ...
  (push (f y) x)
  ...
  (unless y (setf y (g x)))
  ...
  (setf z (h x))
  ...)
\end{verbatim}

The following body of the \texttt{let} form violates the expectations
of the person reading the code:

\begin{verbatim}
(let ((x '())
      (y nil)
      z)
  ...
  (push (f y) z)     ; z is used before it is assigned.
  ...
  (unless x          ; x is treated as a Boolean.
    (setf y (g x)))
  ...
  (push (f x) y)     ; y is treated as a list.
  ...)
\end{verbatim}
