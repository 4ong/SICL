\chapter{Medium-level intermediate representation (MIR)}

The compiler translates an abstract syntax tree into a \emph{graph} of
\emph{instructions} in a language named \textbf{MIR}.  It is a general
graph because an instruction can have zero, one, or more
\emph{successors}, and zero, one, or more \emph{predecessors}.  The
graph can also contain \emph{cycles}.  

An instruction can also have zero, one, or several \emph{inputs} and
zero, one, or more \emph{outputs}.  An input may be an
\emph{immediate} value, a \emph{lexical variable}, or an \emph{entry
  in the linkage vector}.  An output may only be a lexical variable.

Executing a MIR instruction consists of generating the outputs as a
function of the inputs, and also of choosing a successor based on the
inputs.

An execution of a MIR program consists of executing a sequence of
instructions where an instruction in the sequence is the successor
chosen during the execution of the preceding instruction in the
sequence.

\section{Definition of MIR instructions}

\subsection{Instruction \texttt{NOP}}
\label{mir-instruction-NOP}

This instruction has a single successor.  It has no inputs and no
outputs.

Executing this instruction has no effect. 

\subsection{Instruction \texttt{assignment}}
\label{mir-instruction-assignment}

This instruction has a single successor.  It has a single input and a
single output. 

The execution of this instruction results in the input being copied to
the output without any modification. 

\subsection{Instruction \texttt{test}}
\label{mir-instruction-test}

This instruction has two successors.  It has a single input. 

The first successor is chosen if the input is \emph{true} and the
second input is chosen if the input is \emph{false}.%
\fixme{Check that this statement is true.}

\subsection{Instruction \texttt{funcall}}
\label{mir-instruction-funcall}

This instruction has a single successor.  It has a single input and no
outputs.

The input contains the function to be called.  Arguments must already
have been communicated by the use of the \texttt{put-arguments}
instruction. \seesec{mir-instruction-put-arguments}

\subsection{Instruction \texttt{get-arguments}}
\label{mir-instruction-get-arguments}

This instruction has a single successor.%
\fixme{Say more.}

\subsection{Instruction \texttt{get-values}}
\label{mir-instruction-get-values}

This instruction has a single successor.  It has no inputs and it can
have any number of outputs.

The effect of this instruction is to assign the values of a preceding
function call to a set of lexical variables. 

\subsection{Instruction \texttt{put-arguments}}
\label{mir-instruction-put-arguments}

This instruction has a single successor.  It can have any number of
inputs, and it has not outputs. 

The effect of this instruction is to communicate the value of the
inputs as arguments to the next \texttt{funcall}
instruction. \seesec{mir-instruction-funcall}

\subsection{Instruction \texttt{put-values}}
\label{mir-instruction-put-values}

This instruction has a single successor.  It can have any number of
inputs, and it has no outputs. 

The effect of this instruction is to communicate the value of the
inputs as values to be returned when this function finishes its
execution.

\subsection{Instruction \texttt{enter}}
\label{mir-instruction-enter}

\subsection{Instruction \texttt{leave-values}}
\label{mir-instruction-leave-values}

\subsection{Instruction \texttt{return}}
\label{mir-instruction-return}

\subsection{Instruction \texttt{enclose}}
\label{mir-instruction-enclose}

\subsection{Instruction \texttt{memref}}
\label{mir-instruction-memref}

\subsection{Instruction \texttt{memset}}
\label{mir-instruction-memset}

\subsection{Instruction \texttt{u+}}
\label{mir-instruction-u+}

\subsection{Instruction \texttt{u-}}
\label{mir-instruction-u-}

\subsection{Instruction \texttt{s+}}
\label{mir-instruction-s+}

\subsection{Instruction \texttt{s-}}
\label{mir-instruction-s-}

\subsection{Instruction \texttt{neg}}
\label{mir-instruction-neg}

\subsection{Instruction \texttt{\&}}
\label{mir-instruction-and}

\subsection{Instruction \texttt{ior}}
\label{mir-instruction-ior}

\subsection{Instruction \texttt{xor}}
\label{mir-instruction-xor}

\subsection{Instruction \texttt{\~}}
\label{mir-instruction-not}

\subsection{Instruction \texttt{s<}}
\label{mir-instruction-s-less}

\subsection{Instruction \texttt{s<=}}
\label{mir-instruction-s-less-or-equal}

\subsection{Instruction \texttt{u<}}
\label{mir-instruction-u-less}

\subsection{Instruction \texttt{u<=}}
\label{mir-instruction-u-less-or-equal}

\subsection{Instruction \texttt{catch}}
\label{mir-instruction-catch}

\subsection{Instruction \texttt{unwind}}
\label{mir-instruction-unwind}
