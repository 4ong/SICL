\section{Previous work}

\subsection{SBCL}

The \sbcl{} \commonlisp{} implementation unsurprisingly defines the
class \texttt{method\--combination} and then the class
\texttt{standard\--method\--combination} as a subclass of
the class named \texttt{method\--combination}.

More surprisingly, it then defines two subclasses of the class
\texttt{standard\--method\--combination}, namely
\texttt{long\--method\--combination} and
\texttt{short\--method\--combination}, each for use with the different
forms (long and short) of the macro
\texttt{define\--method\--combination}.

An invocation of \texttt{define-method-combination} does not create
any new class.  Instead, an \emph{info} structure is created, and
stored in a hash table that uses the name of the method-combination
type as a key.  This info structure contains a \emph{cache}, which is
an association list.  The key of an element of the association list is
a list of options for the method combination, and the value of an
element is the method-combination object.  Initially, the cache is
empty, except for the info structure associated with the
\texttt{standard} method combination.

The function \texttt{find-method-combination} is given the
method-combination name and the desired options.  It looks up the
appropriate info structure, and searches the cache for an element
corresponding to the options.  If such an element is found, the
method-combination object is returned.  If no element is found, a new
one is constructed, pushed on the cache, and returned.  The new
element is constructed by consing the list of options and the result
of applying a \emph{constructor function} to the list of options.
This constructor function is stored in a slot in the info structure.
As a result, existing method-combination instances are reused whenever
possible.

\sbcl{} handles re-evaluation of \texttt{define-method-combination}
forms with the name of an existing info entry in the hash table.
Every method-combination instance contains a list of back pointers to
generic functions that use this method combination.  The cache of the
existing info entry is traversed, and for each method combination, the
effective methods of its generic functions are invalidated.

\subsection{ECL}

The \ecl{} \commonlisp{} implementation defines the class
\texttt{method-combination}, and method-combination metaobjects are
direct instances of this class, which is not conforming.

The macro \texttt{define-method-combination} does not define a method
combination, nor a new method-combination class.  Instead it defines a
function that we will call the \emph{method-combination function}.
This function computes the effective method of a generic function.
The lambda list of the method-combination function consists of two
required parameters, namely a generic function and a list of
applicable methods, followed by the lambda list given to
\texttt{define-method-combination}.  That lambda list will contain
\texttt{\&optional (order :most-specific-first)} for most built-in
method-combination types.  The resulting function is stored in a hash
table with the name of the method-combination type as a key.

When a generic function is created, a new instance of the
\texttt{method-combination} class is created.  The new instance
contains the method-combination function and a list of the options
given after the method-combination name in the
\texttt{:method-combination} option to \texttt{defgeneric}.

Since a new instance is created each time, two different generic
function that, when created, were given the same method-combination
name and the same method-combination arguments, will have two
different instances of the class \texttt{method-combination}.
