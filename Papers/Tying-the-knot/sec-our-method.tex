\section{Our technique}
\label{sec-our-technique}

\subsection{First-class global environments}

Most \commonlisp{} systems have a single global environment.  Part of
that environment is typically located in slots of symbols.  In
particular, a symbol often contains a \emph{value cell} and a
\emph{function cell}.  In contrast \sicl{} uses first-class global
environments \cite{Strandh:2015:ELS:Environments} that contain this
information, as well as information about classes, types, etc.
With this technique, the name of a function can be associated with
different functions in different global environments.

We invented first-class global environments for two distinct reasons:

\begin{itemize}
\item We want \sicl{} to be a \emph{safe} system.  Part of this safety
  involves protecting the system code itself from malicious external
  software.  In particular, the default global environment contains
  only functionality that the \commonlisp{} standard dictates.  Parts
  of the system such as the compiler are contained in a separate
  global environment that requires some additional manipulation to
  access.
\item \sicl{} is bootstrapped
  \cite{Durand-Strandh:2019:ELS:Bootstrapping} on an existing
  \commonlisp{} implementation.  We use first-class global
  environments to isolate the \sicl{} code from the host system during
  bootstrapping.
\end{itemize}

\subsection{Bootstrapping}

The bootstrapping procedure of \sicl{} first creates an acyclic graph
of metaobjects.  At the end of this process, we have a constellation
of objects in the last two first-class global environments that can be
illustrated as shown in \refFig{fig-constellation}.

\begin{figure}
\begin{center}
\inputfig{fig-constellation.pdf_t}
\end{center}
\caption{\label{fig-constellation}
Constellation of metaobjects in acyclic graph.}
\end{figure}

In \refFig{fig-constellation}, we see two environments.  The last one
created is labeled N and the preceding one is labeled N-1.  Slots such
as the list of methods, the call history, etc. of a generic function
in environment N can be accessed only by accessor generic function in
environment N-1.  Other generic functions in environment N-1 must call
the accessors, also in environment N-1, in order to accomplish higher
level tasks such as computing effective method functions or computing
the discriminating function.

%%  LocalWords:  accessors metaobjects accessor immediates metaobject
