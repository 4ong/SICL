\section{Previous work}

In their article \cite{Constanza:2008}, Costanza and Herzeel give a
simple example of this simple \texttt{defmethod} form:

\begin{verbatim}
(defmethod foo ((x integer) (y integer))
  (do-something x y))
\end{verbatim}

\noindent
and at the end of section 2.1, on page 3, they claim that the
expansion of that form is ``something like'' the follow form:

{\small\begin{verbatim}
(let ((gf (ensure-generic-function 'foo)))
  (multiple-value-bind
      (lambda-expression extra-initargs)
      (make-method-lambda
        gf
        (class-prototype
          (generic-function-method-class gf))
        '(lambda (x y) (do-something x y))
        lexical-environment-of-defmethod-form)
    (add-method
      gf
      (apply #'make-instance
             (generic-function-method-class gf)
             :qualifiers '()
             :lambda-list '(x y)
             :specializers (list (find-class 'integer)
                                 (find-class 'integer))
             :function (compile nil lambda-expression)
             extra-initargs))
\end{verbatim}}

\noindent
except that we have formatted the code to fit the page, and we have
added two missing closing parentheses at the end of the form.

However, this expansion is not possible.  It has two fundamental
problems:

\begin{enumerate}
\item The call to \texttt{make-method-lambda} must be made at
  macro-expansion time, whereas in their example, the call is present
  in the expansion, so it will be made at run time.
\item In their example, the resulting method lambda is compiled in the
  null lexical environment.  However, compiling in the null lexical
  environment would violate the semantics of the \commonlisp{}
  standard, which requires that the body of the \texttt{defmethod}
  form be compiled in lexical environment in which it appears.
\end{enumerate}

Costanza and Herzell further analyzes possible specializations for the
methods on \texttt{make-method-lambda}, and conclude that only the
\texttt{generic-function} and the \texttt{method} parameters can
reasonably be specialized.  They can be forgiven for not being aware
of Strandh's paper on first-class global environments
\cite{Strandh:2015:ELS:Environments}, even though Strandh's paper was
published in 2015, and that of Costanza and Herzell in 2018 and the
environments defined in that paper allow specialization on the
\texttt{environment} parameter as well.
