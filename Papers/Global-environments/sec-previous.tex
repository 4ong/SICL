\section{Previous work}

\subsection{Gelernter et al}

The idea of first-class environments is of course not new.
Gelernter et al \cite{Gelernter:1987:EFC:41625.41634} defined a
language called ``Symmetric Lisp'' in which the programmer is allowed
to evaluate expressions with respect to a particular first-class
environment.  They suggest using this kind of environment as a
replacement for a variety of constructs, including closures,
structures, classes, and modules.  The present paper does not have
this kind of ambitious objective, simply because we do not know how to
obtain excellent performance for all these constructs with our
suggested protocol.

\subsection{Miller and Rozas}

Miller and Rozas \cite{Miller:1991:FVF:113825.113826}

\subsection{Queinnec and Roure}

Queinnec and de Roure \cite{Queinnec:1996:SCT:232627.232653} proposed
a protocol for first-class environments in the context of the
\scheme{} programming language.  Their motivation is different from
ours, in that their environments are meant to be part of the
user-visible interface so as to simplify sharing of various objects.
However, like the present work, they are also concerned with
performance, and they show how to implement their protocol without
serious performance degradation.

\subsection{Garret's lexicons}

Ron Garret desicribes \emph{lexicons}%
\footnote{Unpublished document.  A PDF version can be found here:
  http://www.flownet.com/ron/lisp/lexicons.pdf.}
which are said to be first-class global environments.  However, the
concept of a lexicon is very different from the concept of a
first-class global environment as defined in this paper.

For one thing, a lexicon is ``a mapping from symbols to bindings'',
which excludes a per-environment set of packages, simply because
package names are not symbols, but strings.

Furthermore, a clearly stated goal of lexicons is to create a
different \lisp{} dialect targeted to new users or to users that have
prior experience with languages that are different from \lisp{}.

One explicit goal of lexicons is to replace \commonlisp{} packages, so
that there is a single system-wide symbol with a particular name.  In
contrast, the first-class environments presented in this paper do not
in any way affect the package system.  It should be noted that with
our first-class environments, \emph{symbols are still unique}, i.e.,
for a given package $P$ and a given symbol name $N$, there is at most
one symbol with the name $N$ in $P$; independently of the number of
first-class environments in the system.

Garret discusses the use of lexicons as modules and shows examples
where functions defined in one lexicon can be imported into a
different lexicon.  The use of the operator \texttt{use-lexicon}
imports all the \emph{bindings} of an explicitly-mentioned lexicon
into the current one.  In the present work, we do not emphasize the
possibility of sharing bindings between first-class environment.
However, since functions and global values of special variables are
stored in indirections called \emph{cells} in our environment, such
sharing of bindings would also be possible in the first-class
environments presented in this paper.
